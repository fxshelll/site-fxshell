<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="generator" content="Hugo 0.81.0" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker | FXSHELL</title>
    <meta name="description" content="Aprendizado baseado no curso do Linuxtips, do Jefferson. Apenas para conhecimento sem fins lucrativos postei aqui para o meu aprendizado pessoal.
Quando falamos de container, estamos falando de isolamento. Esse container está sendo executado dentro de um servidor, este fica completamente isolado da maquina. E dentro deste cercado eu tenho processos locais do container. Claro consigo ver os processos do meu host local, o servidor fisico que está rodando este container.">
    <meta name="keywords" content="">
    
    
    
    
    

  <meta name="author" content="">


    <meta property="og:title" content="Docker" />
<meta property="og:description" content="Aprendizado baseado no curso do Linuxtips, do Jefferson. Apenas para conhecimento sem fins lucrativos postei aqui para o meu aprendizado pessoal.
Quando falamos de container, estamos falando de isolamento. Esse container está sendo executado dentro de um servidor, este fica completamente isolado da maquina. E dentro deste cercado eu tenho processos locais do container. Claro consigo ver os processos do meu host local, o servidor fisico que está rodando este container." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/docker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-08T11:10:44-03:00" />
<meta property="article:modified_time" content="2020-10-08T11:10:44-03:00" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker"/>
<meta name="twitter:description" content="Aprendizado baseado no curso do Linuxtips, do Jefferson. Apenas para conhecimento sem fins lucrativos postei aqui para o meu aprendizado pessoal.
Quando falamos de container, estamos falando de isolamento. Esse container está sendo executado dentro de um servidor, este fica completamente isolado da maquina. E dentro deste cercado eu tenho processos locais do container. Claro consigo ver os processos do meu host local, o servidor fisico que está rodando este container."/>

    




    

    
    
  <meta name="referrer" content="same-origin">


    

    
    <link rel="canonical" href="/posts/docker/">
    
    
    <link rel="icon" sizes="any" href="data:image/svg+xml,%3Csvg%20viewBox='0%200%2046%2045'%20xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EAfter%20Dark%3C/title%3E%3Cpath%20d='M.708%2045L23%20.416%2045.292%2045H.708zM35%2038L23%2019%2011%2038h24z'%20fill='%23000'/%3E%3C/svg%3E">

    

  
  
  
  
  
  
  
    
      
        <style>html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:0 0 auto}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a) ".";counter-increment:a}.hack ol li:nth-child(n+10):after{left:-7px}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:""}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:"";border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:transparent}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:"";width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:transparent}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{display:inline-block;content:"&nbsp;";height:20px;width:20px;margin:0 .5rem;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{margin-bottom:0;width:14px;height:14px}.btn div.loading{float:left}.alert .loading{margin-bottom:-5px}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:transparent}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:transparent;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:transparent;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}:root{--screen-size-small:30em}@keyframes intro{0%{opacity:0}; 100%{opacity:1}}.blur-up{-webkit-filter:blur(5px);filter:blur(5px);transition:filter 400ms,-webkit-filter 400ms}.blur-up.lazyloaded{-webkit-filter:blur(0);filter:blur(0)}.hack .readmore{margin-bottom:2.2em}.responsive-iframe{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.responsive-iframe iframe{position:absolute;top:0;left:0;width:100%;height:100%}iframe{border:0}main,footer{animation:intro .3s both;animation-delay:.15s}footer time[datetime$=M]:before{content:"\2013\0020"}@media only screen and (max-width:30em){footer time[datetime$=M]{display:none}}blockquote cite{display:block}blockquote cite::before{content:"\2014"}:target{color:#fff}.hack li ul{margin:0}.main{padding:20px 10px}input.form-control{border-radius:0;background-color:initial;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}input.form-control,textarea.form-control{font-size:initial}.hack .help-block{font-size:1rem}html{font-size:13px}.hack pre{font-size:17px}.hack .form input,.hack .form textarea,.hack .form button,.hack .form label{font-size:1rem}article [itemprop=description]{margin-bottom:20px;margin-top:20px}article header img{width:100%;border-radius:3px}table td,table th{line-height:inherit}img{max-width:100%}@media screen and (min-width:768px){html{font-size:1em}.container{max-width:50rem}}[v-cloak]{display:none}a[rel*="external"]::after {
  content: " " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%23ff9800'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");
}
nav a.active {
  background-color: #ff2e88;
  color: #fff;
}
a[itemprop="url"] {
  color: #ff9800;
}
a[itemprop="url"]:hover {
  color: #fff;
}
.muted, .help-block {
  opacity: 0.70;
}
.hack .muted,
.hack .help-block {
  color: #e0e0e0;
}
</style>
        


  
    <meta name="theme-color" content=#000>
  


      
    
  


    <script>
 
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.fetchInject=t()}(this,function(){"use strict";const e=function(e,t,n,r,o,c,i){c=t.createElement(n),i=t.getElementsByTagName(n)[0],c.appendChild(t.createTextNode(r.text)),c.onload=o(r),i?i.parentNode.insertBefore(c,i):t.head.appendChild(c)};return function(t,n){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));const r=[],o=n?[].concat(n):[],c=[];return t.forEach(e=>o.push(window.fetch(e).then(e=>[e.clone().text(),e.blob()]).then(e=>Promise.all(e).then(e=>{r.push({text:e[0],blob:e[1]})})))),Promise.all(o).then(()=>(r.forEach(t=>{c.push({then:n=>{t.blob.type.includes("text/css")?e(window,document,"style",t,n):e(window,document,"script",t,n)}})}),Promise.all(c)))}});
fetchInject(["/js/lazysizes.min.js"]);
</script>

    <style>
  img {
    max-width: 100%;
  }
</style>

    
    
      <script>fetchInject(["/css/syntax.css"])</script>

      
      <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [['$$','$$']],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          TeX: { equationNumbers: { autoNumber: "AMS" },
              extensions: ["AMSmath.js", "AMSsymbols.js"] }
        }
        });
        MathJax.Hub.Queue(function() {
          
          
          
          var all = MathJax.Hub.getAllJax(), i;
          for(i = 0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
        });

        MathJax.Hub.Config({
        
        TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

      <noscript>
        <link href=/css/syntax.css rel="stylesheet">
      </noscript>
    
  </head>
  
  
  
  <body class="hack dark main container">
    <header>
  
  <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
    
    
      <a itemprop="url" class="" href="/"><span itemprop="name">home</span></a>
    
      <a itemprop="url" class="" href="/posts/"><span itemprop="name">anotações</span></a>
    
      <a itemprop="url" class="" href="/htb/"><span itemprop="name">HTB</span></a>
    
      <a itemprop="url" class="" href="/sobre"><span itemprop="name">sobre</span></a>
    
  </nav>


</header>
    <main>
  <header>
    <h1>Docker</h1>
  </header>
  <p>Aprendizado baseado no curso do Linuxtips, do Jefferson. Apenas para conhecimento sem fins lucrativos postei aqui para o meu aprendizado pessoal.</p>
<p>Quando falamos de container, estamos falando de
isolamento. Esse container está sendo executado
dentro de um servidor, este fica completamente
isolado da maquina. E dentro deste cercado eu
tenho processos locais do container. Claro consigo
ver os processos do meu host local, o servidor
fisico que está rodando este container.</p>
<p>Duas formas de isolamento, lógica e física.</p>
<p>Lógica (namespaces): redes, usuários, processos
Física (Cgroups): CPU, memoria, disco.</p>
<p>#O que é o Docker?</p>
<p>Todos as imagens em camadas são read-only exceto a primeira camada ou seja a ultima é alterada. Se eu tenho 5 Containers de 500mb rodando, não será 5GB de espaço alocado no disco do servidor. Continuará sendo 500MB, pois ele usa a mesma imagem em todas as camadas.</p>
<p>O módulo do kernel Linux é o responsável por criar rotas, redirects e boa parte da tarefa de roteamento de pacotes para o Docker é o <code>Netfilter</code></p>
<p>O módulo do kernel Linux é o responsável pelo isolamento de recursos como CPU e memória é o <code>Cgroups</code></p>
<p>O módulo do kernel Linux é o responsável pelo isolamento de processos, é o <code>namespaces</code></p>
<h1 id="instalando-o-docker">Instalando o Docker</h1>
<p>Comandos Utilizados:</p>
<h1 id="curl--fssl-httpsgetdockercom--bash">curl -fsSL <a href="https://get.docker.com/">https://get.docker.com/</a> | bash</h1>
<h1 id="docker-version">docker version</h1>
<h1 id="docker-container-ls">docker container ls</h1>
<p>a versão paga do Docker é a versão Docker EE (enterprise)</p>
<p>Mas vamos utilizar a versão CE, versão gratuita.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">osboxes@osboxes:~$ docker version
Client: Docker Engine - Community
 Version:           19.03.13
 API version:       1.40
 Go version:        go1.13.15
 Git commit:        4484c46d9d
 Built:             Wed Sep <span class="m">16</span> 17:02:52 <span class="m">2020</span>
 OS/Arch:           linux/amd64
 Experimental:      <span class="nb">false</span>
Got permission denied <span class="k">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/version: dial unix /var/run/docker.sock: connect: permission denied

</code></pre></div><p>#Executando e administrando containers Docker</p>
<p>A primeira coisa a se fazer é o famoso hello-word</p>
<p>Algo como:</p>
<p>#$ docker container run hello-world</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the <span class="s2">&#34;hello-world&#34;</span> image from the Docker Hub.
    <span class="o">(</span>amd64<span class="o">)</span>
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

</code></pre></div><p>Para visualizar todos os containers que estão em execução, parados ou mortos, eu utilizo o comando:</p>
<p>#$ docker container ls -a</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container ls -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
fc4253022db8        hello-world         <span class="s2">&#34;/hello&#34;</span>            <span class="m">36</span> seconds ago      Exited <span class="o">(</span>0<span class="o">)</span> <span class="m">34</span> seconds ago                       reverent_neumann
106fbfd9aba4        hello-world         <span class="s2">&#34;/hello&#34;</span>            <span class="m">8</span> minutes ago       Exited <span class="o">(</span>0<span class="o">)</span> <span class="m">8</span> minutes ago                        hungry_kapitsa

</code></pre></div><p>Outra coisa interessante é usar o comando <code>-ti</code> para cair dentro do container que acabou de subir, ou seja eu quero um terminal com interatividade, no caso seria algo como:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container run -ti ubuntu
Unable to find image <span class="s1">&#39;ubuntu:latest&#39;</span> locally
latest: Pulling from library/ubuntu
d72e567cc804: Pull <span class="nb">complete</span> 
0f3630e5ff08: Pull <span class="nb">complete</span> 
b6a83d81d1f4: Pull <span class="nb">complete</span> 
Digest: sha256:bc2f7250f69267c9c6b66d7b6a81a54d3878bb85f1ebb5f951c896d13e6ba537
Status: Downloaded newer image <span class="k">for</span> ubuntu:latest
root@2fd8c26be92e:/# 
</code></pre></div><p>Perceba que já está dentro do ubuntu que subiu, vamos ver os processos dele agora:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@2fd8c26be92e:/# ps -ef
UID          PID    PPID  C STIME TTY          TIME CMD
root           <span class="m">1</span>       <span class="m">0</span>  <span class="m">0</span> 17:15 pts/0    00:00:00 /bin/bash
root           <span class="m">8</span>       <span class="m">1</span>  <span class="m">0</span> 17:17 pts/0    00:00:00 ps -ef
</code></pre></div><p>Se eu der um CTRL+D eu saiu do container criado e ele morre.</p>
<p>Todo container tem um entrypoint, neste caso é o próprio bash, então quando saimos dele, ele é finalizado também.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container run -ti centos
Unable to find image <span class="s1">&#39;centos:latest&#39;</span> locally
latest: Pulling from library/centos
3c72a8ed6814: Pull <span class="nb">complete</span> 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image <span class="k">for</span> centos:latest
<span class="o">[</span>root@ca53ed399c0d /<span class="o">]</span><span class="c1"># </span>
</code></pre></div><p>Agora subi um CentOS, e já estou dentro dele.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@ca53ed399c0d /<span class="o">]</span><span class="c1"># cat /etc/redhat-release </span>
CentOS Linux release 8.2.2004 <span class="o">(</span>Core<span class="o">)</span> 
</code></pre></div><p>Se eu quero sair do container mas sem matar o container, eu digito <code>ctrl+p+q</code> quando eu volto para o meu host, posso visualizar que ela ainda está rodando.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container ls 
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>         <span class="m">2</span> minutes ago       Up <span class="m">2</span> minutes                            pensive_turing
root@osboxes:~# 
</code></pre></div><p>Como faço para voltar, agora utilizo o comando <code>docker container attach + [CONTAINER ID]</code></p>
<p>#$docker container attach ca53ed399c0d</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container attach ca53ed399c0d
<span class="o">[</span>root@ca53ed399c0d /<span class="o">]</span><span class="c1"># cat /etc/redhat-release </span>
CentOS Linux release 8.2.2004 <span class="o">(</span>Core<span class="o">)</span> 
</code></pre></div><p>Agora se eu subir um container do nginx por exemplo, nunca use a flag <code>-ti</code> vai parecer que está travado, acontece que você pediu para ele criar o container do nginx com interatividade, mas acontece que ele vai tentar abrir uma console, só que o entrypoint do <code>nginx</code> não é o bash, é o próprio processo.</p>
<p>Todo processo tem que estar em execução em primeiro plano, em foreign ground.</p>
<p>Mesmo se você attachar o nginx para tentar acessa-lo ficara parecendo que esta travando, novamente, o nginx está rodando em primeiro plano, se você entrar nele e sair, vai matar o container dele.</p>
<p>Ou seja neste caso não pode estar rodando como daemon.</p>
<p>Neste caso não vou utilizar ele com o <code>-ti</code> mas sim como <code>-d</code>, para rodar como daemon e não com interatividade.</p>
<h1 id="-docker-container-run-nginx">$ docker container run nginx</h1>
<p>Primeiro eu rodo o <code>run</code> sem a flag <code>-d</code> para ele baixar o container pra mim localmente. Ai então rodo com a flag para ele deixar o processo do nginx como daemon.</p>
<h1 id="-docker-container-run--d-nginx">$ docker container run -d nginx</h1>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES
fecca31902c0        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   About a minute ago   Up About a minute   80/tcp              affectionate_dijkstra
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">34</span> hours ago         Up <span class="m">34</span> hours                             pensive_turing

</code></pre></div><p>Agora tenho o CentOS e o Nginx rodando.</p>
<p>Para que eu possa acessar esse container do nginx, visto que o entrypoint dele é o próprio processo, eu executo o comando <code>exec</code></p>
<p>O comando <code>exec</code> me permite rodar comandos no container e me trás os resultados em tela, neste caso posso executar comandos como &ldquo;ls, cat&rdquo; normalmente.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container <span class="nb">exec</span> -ti fecca31902c0 ls
bin   dev		   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
boot  docker-entrypoint.d  etc			 lib   media  opt  root  sbin  sys  usr

</code></pre></div><p>Para ficar melhor, posso executar o bash diretamente.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container <span class="nb">exec</span> -ti fecca31902c0 bash
root@fecca31902c0:/# cat /etc/issue
Debian GNU/Linux <span class="m">10</span> <span class="se">\n</span> <span class="se">\l</span>
</code></pre></div><p>Posso ver até mesmo que o nginx está configurado com a página de boas vindas certinho.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@fecca31902c0:/usr/share/nginx# curl localhost
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body <span class="o">{</span>
        width: 35em<span class="p">;</span>
        margin: <span class="m">0</span> auto<span class="p">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span>
    <span class="o">}</span>
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>Se eu der um CTRL+D para sair do container, ele não vai matar o container por que o processo principal não era o bash, mas sim o daemon que rodei lá atrás.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@fecca31902c0:/usr/share/nginx# <span class="nb">exit</span>
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
fecca31902c0        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   <span class="m">21</span> minutes ago      Up <span class="m">21</span> minutes       80/tcp              affectionate_dijkstra
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">34</span> hours ago        Up <span class="m">34</span> hours                             pensive_turing
</code></pre></div><p>Rodar como daemon é não rodar este cara em primeiro plano, eu coloco -d nos casos que não quero ter interatividade, só quero que a aplicação rode.</p>
<p>E o comando <code>stop</code> eu paro os containers criados.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container stop fecca31902c0
fecca31902c0
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>         <span class="m">34</span> hours ago        Up <span class="m">34</span> hours                             pensive_turing
root@osboxes:~# docker container stop ca53ed399c0d
ca53ed399c0d
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
root@osboxes:~# 

</code></pre></div><p>Assim como também posso startar novamente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container start fecca31902c0
fecca31902c0
root@osboxes:~# docker container start ca53ed399c0d
ca53ed399c0d
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
fecca31902c0        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   <span class="m">37</span> minutes ago      Up <span class="m">11</span> seconds       80/tcp              affectionate_dijkstra
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">34</span> hours ago        Up <span class="m">3</span> seconds                            pensive_turing

</code></pre></div><p>E também tenho o restart do container, caso precise.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container restart fecca31902c0
fecca31902c0
</code></pre></div><p>O comando <code>insepect</code> vai trazer os detalhes daquele container.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container inspect fecca31902c0
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&#34;Id&#34;</span>: <span class="s2">&#34;fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e&#34;</span>,
        <span class="s2">&#34;Created&#34;</span>: <span class="s2">&#34;2020-10-10T03:11:02.088105653Z&#34;</span>,
        <span class="s2">&#34;Path&#34;</span>: <span class="s2">&#34;/docker-entrypoint.sh&#34;</span>,
        <span class="s2">&#34;Args&#34;</span>: <span class="o">[</span>
            <span class="s2">&#34;nginx&#34;</span>,
            <span class="s2">&#34;-g&#34;</span>,
            <span class="s2">&#34;daemon off;&#34;</span>
        <span class="o">]</span>,
        <span class="s2">&#34;State&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Status&#34;</span>: <span class="s2">&#34;running&#34;</span>,
            <span class="s2">&#34;Running&#34;</span>: true,
            <span class="s2">&#34;Paused&#34;</span>: false,
            <span class="s2">&#34;Restarting&#34;</span>: false,
            <span class="s2">&#34;OOMKilled&#34;</span>: false,
            <span class="s2">&#34;Dead&#34;</span>: false,
            <span class="s2">&#34;Pid&#34;</span>: 83380,
            <span class="s2">&#34;ExitCode&#34;</span>: 0,
            <span class="s2">&#34;Error&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;StartedAt&#34;</span>: <span class="s2">&#34;2020-10-10T03:49:45.95038292Z&#34;</span>,
            <span class="s2">&#34;FinishedAt&#34;</span>: <span class="s2">&#34;2020-10-10T03:49:45.218821799Z&#34;</span>
        <span class="o">}</span>,
        <span class="s2">&#34;Image&#34;</span>: <span class="s2">&#34;sha256:992e3b7be0465856d44bed9b3d5596267205a4cfaec4241439be42f77b3539a3&#34;</span>,
        <span class="s2">&#34;ResolvConfPath&#34;</span>: <span class="s2">&#34;/var/lib/docker/containers/fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e/resolv.conf&#34;</span>,
        <span class="s2">&#34;HostnamePath&#34;</span>: <span class="s2">&#34;/var/lib/docker/containers/fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e/hostname&#34;</span>,
        <span class="s2">&#34;HostsPath&#34;</span>: <span class="s2">&#34;/var/lib/docker/containers/fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e/hosts&#34;</span>,
        <span class="s2">&#34;LogPath&#34;</span>: <span class="s2">&#34;/var/lib/docker/containers/fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e/fecca31902c05350d920db4c3ed35793d64b155e06894ce15c026a8632c74e2e-json.log&#34;</span>,
        <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;/affectionate_dijkstra&#34;</span>,
        <span class="s2">&#34;RestartCount&#34;</span>: 0,
        <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;overlay2&#34;</span>,
        <span class="s2">&#34;Platform&#34;</span>: <span class="s2">&#34;linux&#34;</span>,
        <span class="s2">&#34;MountLabel&#34;</span>: <span class="s2">&#34;&#34;</span>,
        <span class="s2">&#34;ProcessLabel&#34;</span>: <span class="s2">&#34;&#34;</span>,
        <span class="s2">&#34;AppArmorProfile&#34;</span>: <span class="s2">&#34;docker-default&#34;</span>,
        <span class="s2">&#34;ExecIDs&#34;</span>: null,
        <span class="s2">&#34;HostConfig&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Binds&#34;</span>: null,
            <span class="s2">&#34;ContainerIDFile&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;LogConfig&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;Type&#34;</span>: <span class="s2">&#34;json-file&#34;</span>,
                <span class="s2">&#34;Config&#34;</span>: <span class="o">{}</span>
            <span class="o">}</span>,
            <span class="s2">&#34;NetworkMode&#34;</span>: <span class="s2">&#34;default&#34;</span>,
            <span class="s2">&#34;PortBindings&#34;</span>: <span class="o">{}</span>,
            <span class="s2">&#34;RestartPolicy&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;no&#34;</span>,
                <span class="s2">&#34;MaximumRetryCount&#34;</span>: <span class="m">0</span>
            <span class="o">}</span>,
            <span class="s2">&#34;AutoRemove&#34;</span>: false,
            <span class="s2">&#34;VolumeDriver&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;VolumesFrom&#34;</span>: null,
            <span class="s2">&#34;CapAdd&#34;</span>: null,
            <span class="s2">&#34;CapDrop&#34;</span>: null,
            <span class="s2">&#34;Capabilities&#34;</span>: null,
            <span class="s2">&#34;Dns&#34;</span>: <span class="o">[]</span>,
            <span class="s2">&#34;DnsOptions&#34;</span>: <span class="o">[]</span>,
            <span class="s2">&#34;DnsSearch&#34;</span>: <span class="o">[]</span>,
            <span class="s2">&#34;ExtraHosts&#34;</span>: null,
            <span class="s2">&#34;GroupAdd&#34;</span>: null,
            <span class="s2">&#34;IpcMode&#34;</span>: <span class="s2">&#34;private&#34;</span>,
            <span class="s2">&#34;Cgroup&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;Links&#34;</span>: null,
            <span class="s2">&#34;OomScoreAdj&#34;</span>: 0,
            <span class="s2">&#34;PidMode&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;Privileged&#34;</span>: false,
            <span class="s2">&#34;PublishAllPorts&#34;</span>: false,
            <span class="s2">&#34;ReadonlyRootfs&#34;</span>: false,
            <span class="s2">&#34;SecurityOpt&#34;</span>: null,
            <span class="s2">&#34;UTSMode&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;UsernsMode&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;ShmSize&#34;</span>: 67108864,
            <span class="s2">&#34;Runtime&#34;</span>: <span class="s2">&#34;runc&#34;</span>,
            <span class="s2">&#34;ConsoleSize&#34;</span>: <span class="o">[</span>
                0,
                <span class="m">0</span>
            <span class="o">]</span>,
            <span class="s2">&#34;Isolation&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;CpuShares&#34;</span>: 0,
            <span class="s2">&#34;Memory&#34;</span>: 0,
            <span class="s2">&#34;NanoCpus&#34;</span>: 0,
            <span class="s2">&#34;CgroupParent&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;BlkioWeight&#34;</span>: 0,
            <span class="s2">&#34;BlkioWeightDevice&#34;</span>: <span class="o">[]</span>,
            <span class="s2">&#34;BlkioDeviceReadBps&#34;</span>: null,
            <span class="s2">&#34;BlkioDeviceWriteBps&#34;</span>: null,
            <span class="s2">&#34;BlkioDeviceReadIOps&#34;</span>: null,
            <span class="s2">&#34;BlkioDeviceWriteIOps&#34;</span>: null,
            <span class="s2">&#34;CpuPeriod&#34;</span>: 0,
            <span class="s2">&#34;CpuQuota&#34;</span>: 0,
            <span class="s2">&#34;CpuRealtimePeriod&#34;</span>: 0,
            <span class="s2">&#34;CpuRealtimeRuntime&#34;</span>: 0,
            <span class="s2">&#34;CpusetCpus&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;CpusetMems&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;Devices&#34;</span>: <span class="o">[]</span>,
            <span class="s2">&#34;DeviceCgroupRules&#34;</span>: null,
            <span class="s2">&#34;DeviceRequests&#34;</span>: null,
            <span class="s2">&#34;KernelMemory&#34;</span>: 0,
            <span class="s2">&#34;KernelMemoryTCP&#34;</span>: 0,
            <span class="s2">&#34;MemoryReservation&#34;</span>: 0,
            <span class="s2">&#34;MemorySwap&#34;</span>: 0,
            <span class="s2">&#34;MemorySwappiness&#34;</span>: null,
            <span class="s2">&#34;OomKillDisable&#34;</span>: false,
            <span class="s2">&#34;PidsLimit&#34;</span>: null,
            <span class="s2">&#34;Ulimits&#34;</span>: null,
            <span class="s2">&#34;CpuCount&#34;</span>: 0,
            <span class="s2">&#34;CpuPercent&#34;</span>: 0,
            <span class="s2">&#34;IOMaximumIOps&#34;</span>: 0,
            <span class="s2">&#34;IOMaximumBandwidth&#34;</span>: 0,
            <span class="s2">&#34;MaskedPaths&#34;</span>: <span class="o">[</span>
                <span class="s2">&#34;/proc/asound&#34;</span>,
                <span class="s2">&#34;/proc/acpi&#34;</span>,
                <span class="s2">&#34;/proc/kcore&#34;</span>,
                <span class="s2">&#34;/proc/keys&#34;</span>,
                <span class="s2">&#34;/proc/latency_stats&#34;</span>,
                <span class="s2">&#34;/proc/timer_list&#34;</span>,
                <span class="s2">&#34;/proc/timer_stats&#34;</span>,
                <span class="s2">&#34;/proc/sched_debug&#34;</span>,
                <span class="s2">&#34;/proc/scsi&#34;</span>,
                <span class="s2">&#34;/sys/firmware&#34;</span>
            <span class="o">]</span>,
            <span class="s2">&#34;ReadonlyPaths&#34;</span>: <span class="o">[</span>
                <span class="s2">&#34;/proc/bus&#34;</span>,
                <span class="s2">&#34;/proc/fs&#34;</span>,
                <span class="s2">&#34;/proc/irq&#34;</span>,
                <span class="s2">&#34;/proc/sys&#34;</span>,
                <span class="s2">&#34;/proc/sysrq-trigger&#34;</span>
            <span class="o">]</span>
        <span class="o">}</span>,
        <span class="s2">&#34;GraphDriver&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Data&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;LowerDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/26828e39601076b546dccc85c380c95cf5cc0b522e323146d1b95d11ea7937f0-init/diff:/var/lib/docker/overlay2/84650e899c555dc002159c3c23c29e89e034100f74fd3cbb06e780ad664becf9/diff:/var/lib/docker/overlay2/1e436d1da6e23864fe43e1edc99b400aedf747d7c40c233334adc8dc8d605863/diff:/var/lib/docker/overlay2/ea346940afd1708c365a570cc67b1736ff34fe3abee91a19cd79ce0456dcfc80/diff:/var/lib/docker/overlay2/7a5860acc38166730e81c14f29786ca662e46d9a3470b89db74bf2c6f22373e9/diff:/var/lib/docker/overlay2/5fe8bdb9845162cbb357ac3c5d2a24ebedacca1d689eb69c1658d408fb5896db/diff&#34;</span>,
                <span class="s2">&#34;MergedDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/26828e39601076b546dccc85c380c95cf5cc0b522e323146d1b95d11ea7937f0/merged&#34;</span>,
                <span class="s2">&#34;UpperDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/26828e39601076b546dccc85c380c95cf5cc0b522e323146d1b95d11ea7937f0/diff&#34;</span>,
                <span class="s2">&#34;WorkDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/26828e39601076b546dccc85c380c95cf5cc0b522e323146d1b95d11ea7937f0/work&#34;</span>
            <span class="o">}</span>,
            <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;overlay2&#34;</span>
        <span class="o">}</span>,
        <span class="s2">&#34;Mounts&#34;</span>: <span class="o">[]</span>,
        <span class="s2">&#34;Config&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Hostname&#34;</span>: <span class="s2">&#34;fecca31902c0&#34;</span>,
            <span class="s2">&#34;Domainname&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;User&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;AttachStdin&#34;</span>: false,
            <span class="s2">&#34;AttachStdout&#34;</span>: false,
            <span class="s2">&#34;AttachStderr&#34;</span>: false,
            <span class="s2">&#34;ExposedPorts&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;80/tcp&#34;</span>: <span class="o">{}</span>
            <span class="o">}</span>,
            <span class="s2">&#34;Tty&#34;</span>: false,
            <span class="s2">&#34;OpenStdin&#34;</span>: false,
            <span class="s2">&#34;StdinOnce&#34;</span>: false,
            <span class="s2">&#34;Env&#34;</span>: <span class="o">[</span>
                <span class="s2">&#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span>,
                <span class="s2">&#34;NGINX_VERSION=1.19.3&#34;</span>,
                <span class="s2">&#34;NJS_VERSION=0.4.4&#34;</span>,
                <span class="s2">&#34;PKG_RELEASE=1~buster&#34;</span>
            <span class="o">]</span>,
            <span class="s2">&#34;Cmd&#34;</span>: <span class="o">[</span>
                <span class="s2">&#34;nginx&#34;</span>,
                <span class="s2">&#34;-g&#34;</span>,
                <span class="s2">&#34;daemon off;&#34;</span>
            <span class="o">]</span>,
            <span class="s2">&#34;Image&#34;</span>: <span class="s2">&#34;nginx&#34;</span>,
            <span class="s2">&#34;Volumes&#34;</span>: null,
            <span class="s2">&#34;WorkingDir&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;Entrypoint&#34;</span>: <span class="o">[</span>
                <span class="s2">&#34;/docker-entrypoint.sh&#34;</span>
            <span class="o">]</span>,
            <span class="s2">&#34;OnBuild&#34;</span>: null,
            <span class="s2">&#34;Labels&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;maintainer&#34;</span>: <span class="s2">&#34;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&#34;</span>
            <span class="o">}</span>,
            <span class="s2">&#34;StopSignal&#34;</span>: <span class="s2">&#34;SIGTERM&#34;</span>
        <span class="o">}</span>,
        <span class="s2">&#34;NetworkSettings&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Bridge&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;SandboxID&#34;</span>: <span class="s2">&#34;025bdf57c2c369552c5538135b7e5007d4491807375357f7bce90a802291915a&#34;</span>,
            <span class="s2">&#34;HairpinMode&#34;</span>: false,
            <span class="s2">&#34;LinkLocalIPv6Address&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;LinkLocalIPv6PrefixLen&#34;</span>: 0,
            <span class="s2">&#34;Ports&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;80/tcp&#34;</span>: null
            <span class="o">}</span>,
            <span class="s2">&#34;SandboxKey&#34;</span>: <span class="s2">&#34;/var/run/docker/netns/025bdf57c2c3&#34;</span>,
            <span class="s2">&#34;SecondaryIPAddresses&#34;</span>: null,
            <span class="s2">&#34;SecondaryIPv6Addresses&#34;</span>: null,
            <span class="s2">&#34;EndpointID&#34;</span>: <span class="s2">&#34;61173c80ab6b1c9c01b93c48df85a8dfb3612d644d38a084e3abad2a7e24f0d0&#34;</span>,
            <span class="s2">&#34;Gateway&#34;</span>: <span class="s2">&#34;172.17.0.1&#34;</span>,
            <span class="s2">&#34;GlobalIPv6Address&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
            <span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;172.17.0.2&#34;</span>,
            <span class="s2">&#34;IPPrefixLen&#34;</span>: 16,
            <span class="s2">&#34;IPv6Gateway&#34;</span>: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;MacAddress&#34;</span>: <span class="s2">&#34;02:42:ac:11:00:02&#34;</span>,
            <span class="s2">&#34;Networks&#34;</span>: <span class="o">{</span>
                <span class="s2">&#34;bridge&#34;</span>: <span class="o">{</span>
                    <span class="s2">&#34;IPAMConfig&#34;</span>: null,
                    <span class="s2">&#34;Links&#34;</span>: null,
                    <span class="s2">&#34;Aliases&#34;</span>: null,
                    <span class="s2">&#34;NetworkID&#34;</span>: <span class="s2">&#34;6bf2ac8e47d6de141905be78499c34f36b89ace5586c89a38be3090a8881365c&#34;</span>,
                    <span class="s2">&#34;EndpointID&#34;</span>: <span class="s2">&#34;61173c80ab6b1c9c01b93c48df85a8dfb3612d644d38a084e3abad2a7e24f0d0&#34;</span>,
                    <span class="s2">&#34;Gateway&#34;</span>: <span class="s2">&#34;172.17.0.1&#34;</span>,
                    <span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;172.17.0.2&#34;</span>,
                    <span class="s2">&#34;IPPrefixLen&#34;</span>: 16,
                    <span class="s2">&#34;IPv6Gateway&#34;</span>: <span class="s2">&#34;&#34;</span>,
                    <span class="s2">&#34;GlobalIPv6Address&#34;</span>: <span class="s2">&#34;&#34;</span>,
                    <span class="s2">&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
                    <span class="s2">&#34;MacAddress&#34;</span>: <span class="s2">&#34;02:42:ac:11:00:02&#34;</span>,
                    <span class="s2">&#34;DriverOpts&#34;</span>: null
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">]</span>
root@osboxes:~# 
</code></pre></div><p>Posso também pausar um container com o comando <code>pause</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container pause fecca31902c0
fecca31902c0
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                  PORTS               NAMES
fecca31902c0        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   <span class="m">43</span> minutes ago      Up <span class="m">5</span> minutes <span class="o">(</span>Paused<span class="o">)</span>   80/tcp              affectionate_dijkstra
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">35</span> hours ago        Up <span class="m">6</span> minutes                                pensive_turing
root@osboxes:~# docker container unpause fecca31902c0
fecca31902c0
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
fecca31902c0        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   <span class="m">43</span> minutes ago      Up <span class="m">5</span> minutes        80/tcp              affectionate_dijkstra
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">35</span> hours ago        Up <span class="m">6</span> minutes                            pensive_turing

</code></pre></div><p>Para que eu possa ver os logs deste container, utilizo o comando <code>logs</code> seguido da flag <code>-f</code> e ID para ficar monitorando.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container logs -f fecca31902c0
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="k">for</span> shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Configuration complete<span class="p">;</span> ready <span class="k">for</span> start up
127.0.0.1 - - <span class="o">[</span>10/Oct/2020:03:26:52 +0000<span class="o">]</span> <span class="s2">&#34;GET / HTTP/1.1&#34;</span> <span class="m">200</span> <span class="m">612</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;curl/7.64.0&#34;</span> <span class="s2">&#34;-&#34;</span>
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
</code></pre></div><p>Para remover um container, basta utilizar o comando rm, porém se o mesmo estiver em execução, ele não vai deixar. Para isso basta fazer um <code>rm -f</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
425c61ede184        nginx               <span class="s2">&#34;/docker-entrypoint.…&#34;</span>   <span class="m">2</span> minutes ago       Up <span class="m">2</span> minutes        80/tcp              romantic_hofstadter
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">35</span> hours ago        Up <span class="m">15</span> minutes                           pensive_turing
root@osboxes:~# docker container rm 425c61ede184
Error response from daemon: You cannot remove a running container 425c61ede184f202b4ae9c3678c429735296fa916253dc953d723414cd3d52cb. Stop the container before attempting removal or force remove
root@osboxes:~# docker container rm -f 425c61ede184
425c61ede184
root@osboxes:~# docker container rm -f 425c61ede184
425c61ede184
root@osboxes:~# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ca53ed399c0d        centos              <span class="s2">&#34;/bin/bash&#34;</span>         <span class="m">35</span> hours ago        Up <span class="m">18</span> minutes                           pensive_turing

</code></pre></div><h1 id="configurando-cpu-e-memória-para-os-meus-containers">Configurando CPU e memória para os meus containers</h1>
<p>Para checar como está o uso de recursos do container, eu utilizo o comando <code>stats</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container stats 7f824cb8005e
</code></pre></div><p>Para testar os recursos pode-se utilizar o programa Stress.</p>
<p><code>root@7f824cb8005e:/# apt-get install stress</code></p>
<p>Para ver detalhes do seu uso, utilize</p>
<h1 id="-stress---help">$ stress &ndash;help</h1>
<p>Fiz o seguinte comando</p>
<p><code>stress --cpu 1 --vm-bytes 128 --vm 1</code></p>
<p>Posso utilizar para ver os dados também o famoso <code>top</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container top 7f824cb8005e
</code></pre></div><p>Claro, se o mesmo estiver instalado no container</p>
<p>Para criar um container do nginx por exemplo com limitação de memória e cpu, eu posso definir isso na criação. Exemplo:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container run -d -m 128M --cpus 0.5 nginx
</code></pre></div><p>Neste caso estou definindo 128MB de ram para o container e que ele se limite a usar só 50% de CPU.</p>
<p>Posso testar utilizando o stress.</p>
<p>Agora quero mudar quero que utilize 80% de CPU, então eu posso fazer um update.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container update --cpus 0.8  --memory 64M 7f824cb8005e
</code></pre></div><p>Agora ele vai utilizar 80% de CPU e 64MB de memória, para o ID que no caso é do nginx.</p>
<h1 id="criando-um-dockerfile">Criando um Dockerfile</h1>
<p>Depois de criar uma pasta para alocar o Dockerfile, eu crio um arquivo no vim</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM debian

LABEL <span class="nv">app</span><span class="o">=</span><span class="s2">&#34;BIKER&#34;</span>
ENV <span class="nv">FXSHELL</span><span class="o">=</span><span class="s2">&#34;Devops&#34;</span>

RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y stress <span class="o">&amp;&amp;</span> apt-get clean

CMD stress --cpu <span class="m">1</span> --vm-bytes 64M --vm <span class="m">1</span>
</code></pre></div><p>Depois de criado, vou buildar</p>
<h1 id="-docker-image-build--t-toskeira10">$ docker image build -t toskeira:1.0</h1>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~/tosko_dockerfile# docker image build -t toskeira:1.0 .
Sending build context to Docker daemon  2.048kB
Step 1/5 : FROM debian
latest: Pulling from library/debian
57df1a1f1ad8: Pull <span class="nb">complete</span> 
Digest: sha256:439a6bae1ef351ba9308fc9a5e69ff7754c14516f6be8ca26975fb564cb7fb76
Status: Downloaded newer image <span class="k">for</span> debian:latest
 ---&gt; f6dcff9b59af
Step 2/5 : LABEL <span class="nv">app</span><span class="o">=</span><span class="s2">&#34;moranguinho&#34;</span>
 ---&gt; Running in c329bf2c69e1
Removing intermediate container c329bf2c69e1
 ---&gt; d59dacfad6f9
Step 3/5 : ENV <span class="nv">FELIPE</span><span class="o">=</span><span class="s2">&#34;Lindo&#34;</span>
 ---&gt; Running in 8c2387746f05
Removing intermediate container 8c2387746f05
 ---&gt; 36c9c0b6beb9
Step 4/5 : RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y stress <span class="o">&amp;&amp;</span> apt-get clean
 ---&gt; Running in f4b8d2261527
Get:1 http://security.debian.org/debian-security buster/updates InRelease <span class="o">[</span>65.4 kB<span class="o">]</span>
Get:2 http://deb.debian.org/debian buster InRelease <span class="o">[</span><span class="m">121</span> kB<span class="o">]</span>
Get:3 http://deb.debian.org/debian buster-updates InRelease <span class="o">[</span>51.9 kB<span class="o">]</span>
Get:4 http://deb.debian.org/debian buster/main amd64 Packages <span class="o">[</span><span class="m">7906</span> kB<span class="o">]</span>
Get:5 http://security.debian.org/debian-security buster/updates/main amd64 Packages <span class="o">[</span><span class="m">233</span> kB<span class="o">]</span>
Get:6 http://deb.debian.org/debian buster-updates/main amd64 Packages <span class="o">[</span><span class="m">7868</span> B<span class="o">]</span>
Fetched <span class="m">8387</span> kB in 11s <span class="o">(</span><span class="m">794</span> kB/s<span class="o">)</span>
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following NEW packages will be installed:
  stress
<span class="m">0</span> upgraded, <span class="m">1</span> newly installed, <span class="m">0</span> to remove and <span class="m">1</span> not upgraded.
Need to get 21.8 kB of archives.
After this operation, 55.3 kB of additional disk space will be used.
Get:1 http://deb.debian.org/debian buster/main amd64 stress amd64 1.0.4-4 <span class="o">[</span>21.8 kB<span class="o">]</span>
debconf: delaying package configuration, since apt-utils is not installed
Fetched 21.8 kB in 8s <span class="o">(</span><span class="m">2708</span> B/s<span class="o">)</span>
Selecting previously unselected package stress.
<span class="o">(</span>Reading database ... <span class="m">6677</span> files and directories currently installed.<span class="o">)</span>
Preparing to unpack .../stress_1.0.4-4_amd64.deb ...
Unpacking stress <span class="o">(</span>1.0.4-4<span class="o">)</span> ...
Setting up stress <span class="o">(</span>1.0.4-4<span class="o">)</span> ...
Removing intermediate container f4b8d2261527
 ---&gt; 3662327fda9e
Step 5/5 : CMD stress --cpu <span class="m">1</span> --vm-bytes 64M --vm <span class="m">1</span>
 ---&gt; Running in 83774952c3c4
Removing intermediate container 83774952c3c4
 ---&gt; d24fe1c0773b
Successfully built d24fe1c0773b
Successfully tagged toskeira:1.0
root@osboxes:~/tosko_dockerfile# 
</code></pre></div><p>Certo, agora se eu der um comando, <code>docker image ls</code> ele vai exibir a nossa imagem recem criada.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~/tosko_dockerfile# docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE
toskeira            1.0                 d24fe1c0773b        About a minute ago   133MB
</code></pre></div><p>Para executar</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker container run -d toskeira:1.0
</code></pre></div><p>Limitando memoria</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker container run -d --memory 64M  toskeira:1.0
</code></pre></div><p>Posso também utilizar o comando update.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@osboxes:~# docker container update --cpus 0.8  --memory 64M <span class="o">[</span>CONTAINER ID<span class="o">]</span>
</code></pre></div><p>Limitando CPU para 80% e memoria para 64M</p>
<p>#Entendendo volumes</p>
<p>Volumes nada mais sao do que diretorios externos ao container, que são montados diretamente nele, dessa forma bypassam seu filesystem, ou seja, não seguem aquele padrão de camadas.</p>
<p>A principal função do volume é persistir os dados. Diferentemente do filesystem do container, que é volátil e toda informação escrita nele é perdida quando o container morre, quando você escreve em um volume aquele dado continua lá. independentemente do estado do container.</p>
<p>=&gt; É iniciado quando o container é criado</p>
<p>=&gt; Caso ocorra de já haver dados no diretório em que você está montando como volume, ou seja, se o diretório já existe e já está populado na imagem base, aqueles dados serão copiados para o volume.</p>
<p>=&gt; Um volume pode ser reusado e compartilhado entre os containers.</p>
<p>=&gt; Alterações em um volume são feitas diretamente do volume.</p>
<p>=&gt; Alterações em um volume não irão com a imagem quando você fizer uma cópia ou snapshot de um container.</p>
<p>=&gt; Volumes continuam a existir mesmo se você deletar o container.</p>
<p>#Exemplo</p>
<p>Criamos uma pasta para montar nosso volume no local:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# mkdir /opt/moranguinho
</code></pre></div><p>Volumes do tipo bind é quando eu já tenho um diretório que quero montar especifico.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/opt/moranguinho,dst<span class="o">=</span>/moranguinho debian
</code></pre></div><p>Beleza, já dentro do container crio um arquivo de teste dentro do volume.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@07b30662ffc0:/# <span class="nb">cd</span> moranguinho/
root@07b30662ffc0:/moranguinho# ls
root@07b30662ffc0:/moranguinho# ls
root@07b30662ffc0:/moranguinho# touch teste
root@07b30662ffc0:/moranguinho# <span class="nb">exit</span>
<span class="nb">exit</span>
root@FXSHELL ~# <span class="nb">cd</span> /opt/moranguinho/
root@FXSHELL /o/moranguinho# ls
teste
root@FXSHELL /o/moranguinho# 
</code></pre></div><p>Agora se eu executar um outro container, posso notar que o volume continua o mesmo e com o arquivo criado no passo anterior lá dentro.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /o/moranguinho# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/opt/moranguinho,dst<span class="o">=</span>/moranguinho debian
root@c72d32bd0846:/# ls
bin   dev  moranguinho  lib    media  opt   root  sbin  sys  usr
boot  etc  home      lib64  mnt    proc  run   srv   tmp  var
root@c72d32bd0846:/# <span class="nb">cd</span> moranguinho/
root@c72d32bd0846:/moranguinho# ls
teste
root@c72d32bd0846:/moranguinho# 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@9911369c74af:/# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay         217G  8.8G  197G   5% /
tmpfs            64M     <span class="m">0</span>   64M   0% /dev
tmpfs           491M     <span class="m">0</span>  491M   0% /sys/fs/cgroup
shm              64M     <span class="m">0</span>   64M   0% /dev/shm
/dev/sda1       217G  8.8G  197G   5% /moranguinho
tmpfs           491M     <span class="m">0</span>  491M   0% /proc/asound
tmpfs           491M     <span class="m">0</span>  491M   0% /proc/acpi
tmpfs           491M     <span class="m">0</span>  491M   0% /proc/scsi
tmpfs           491M     <span class="m">0</span>  491M   0% /sys/firmware
root@9911369c74af:/# 
</code></pre></div><p>Este é o volume do tipo <code>bind</code></p>
<p>OBS: também posso definir o volume somente como leitura definindo o parametro <code>ro</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/opt/moranguinho,dst<span class="o">=</span>/moranguinho,ro debian
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /o/moranguinho# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/opt/moranguinho,dst<span class="o">=</span>/moranguinho,ro debian
root@e779e386475a:/# <span class="nb">cd</span> moranguinho/
root@e779e386475a:/moranguinho# ls
teste  teste2
root@e779e386475a:/moranguinho# touch teste3
touch: cannot touch <span class="s1">&#39;teste3&#39;</span>: Read-only file system
root@e779e386475a:/moranguinho# 
</code></pre></div><p>Mostrando a mensagem como read-only.</p>
<p>#Docker volume</p>
<p>Posso checar todos os volumes criados com o comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker volume ls
DRIVER              VOLUME NAME
root@FXSHELL ~# docker volume create moranguinho
moranguinho
root@FXSHELL ~# ls
snap/  tosko_dockerfile/
root@FXSHELL ~# docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               moranguinho
root@FXSHELL ~# docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               moranguinho
root@FXSHELL ~# docker volume inspect moranguinho
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&#34;CreatedAt&#34;</span>: <span class="s2">&#34;2021-01-19T20:55:40-05:00&#34;</span>,
        <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;local&#34;</span>,
        <span class="s2">&#34;Labels&#34;</span>: <span class="o">{}</span>,
        <span class="s2">&#34;Mountpoint&#34;</span>: <span class="s2">&#34;/var/lib/docker/volumes/moranguinho/_data&#34;</span>,
        <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;moranguinho&#34;</span>,
        <span class="s2">&#34;Options&#34;</span>: <span class="o">{}</span>,
        <span class="s2">&#34;Scope&#34;</span>: <span class="s2">&#34;local&#34;</span>
    <span class="o">}</span>
<span class="o">]</span>
root@FXSHELL ~# 
</code></pre></div><p>Tudo e qualquer volume no docker, vai estar dentro de &ldquo;/var/lib/docker/volumes&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# <span class="nb">cd</span> /var/lib/docker/volumes/
root@FXSHELL /v/l/d/volumes# ls
moranguinho/  metadata.db
root@FXSHELL /v/l/d/volumes# 
</code></pre></div><p>Posso colocar meus arquivos dentro da pasta _&quot;<em>data&quot; que fica dentro da pasta do volume</em></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /v/l/d/volumes# ls
moranguinho/  metadata.db
root@FXSHELL /v/l/d/volumes# <span class="nb">cd</span> moranguinho/_data/
root@FXSHELL /v/l/d/v/g/_data# touch teste1 teste2 teste3
root@FXSHELL /v/l/d/v/g/_data# ls
teste1  teste2  teste3
root@FXSHELL /v/l/d/v/g/_data# 
</code></pre></div><p>Posso montar esse volume também em um container, passando o tipo que agora não será tipo bind, mas sim <em>volume</em></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>moranguinho,dst<span class="o">=</span>/moranguinho debian
root@4df1fe08b1da:/# ls
bin   dev  moranguinho  lib    media  opt   root  sbin  sys  usr
boot  etc  home      lib64  mnt    proc  run   srv   tmp  var
root@4df1fe08b1da:/# <span class="nb">cd</span> moranguinho/
root@4df1fe08b1da:/moranguinho# ls
teste1  teste2  teste3
root@4df1fe08b1da:/moranguinho# touch teste4_final
</code></pre></div><p>Depois mato o container e vejo na pasta do volume, e eis o arquivo teste4_final está lá dentro.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# <span class="nb">cd</span> /var/lib/docker/volumes/
root@FXSHELL /v/l/d/volumes# ls
moranguinho/  metadata.db
root@FXSHELL /v/l/d/volumes# <span class="nb">cd</span> moranguinho/_data/
root@FXSHELL /v/l/d/v/g/_data# ls
teste1  teste2  teste3  teste4_final
root@FXSHELL /v/l/d/v/g/_data# 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /v/l/d/v/g/_data# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
4983b4a108a3        debian              <span class="s2">&#34;bash&#34;</span>              <span class="m">11</span> seconds ago      Up <span class="m">10</span> seconds                           frosty_bartik
root@FXSHELL /v/l/d/v/g/_data# 
docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>moranguinho,dst<span class="o">=</span>/moranguinho debian
root@13aacd8dfd58:/# ls
bin   dev  moranguinho  lib    media  opt   root  sbin  sys  usr
boot  etc  home      lib64  mnt    proc  run   srv   tmp  var
root@13aacd8dfd58:/# <span class="nb">cd</span> moranguinho/
root@13aacd8dfd58:/moranguinho# ls
teste1  teste2  teste3  teste4_final
root@13aacd8dfd58:/moranguinho# ⏎                                               root@FXSHELL /v/l/d/v/g/_data# ls
teste1  teste2  teste3  teste4_final
root@FXSHELL /v/l/d/v/g/_data# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES
13aacd8dfd58        debian              <span class="s2">&#34;bash&#34;</span>              <span class="m">14</span> seconds ago       Up <span class="m">12</span> seconds                           flamboyant_moore
4983b4a108a3        debian              <span class="s2">&#34;bash&#34;</span>              About a minute ago   Up About a minute                       frosty_bartik
root@FXSHELL /v/l/d/v/g/_data# 
docker container <span class="nb">exec</span> -ti 13aacd8dfd58 touch /moranguinho/13aacd8dfd58
root@FXSHELL /v/l/d/v/g/_data# 
docker container <span class="nb">exec</span> -ti 4983b4a108a3 touch /moranguinho/4983b4a108a3
root@FXSHELL /v/l/d/v/g/_data# ls
13aacd8dfd58  4983b4a108a3  teste1  teste2  teste3  teste4_final
root@FXSHELL /v/l/d/v/g/_data# 
</code></pre></div><p>Para remover o volume basta remover todos os containers que estiverem em uso com ele.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /v/l/d/v/g/_data <span class="o">[</span>1<span class="o">]</span><span class="c1"># docker container ls -a</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES
4df1fe08b1da        debian              <span class="s2">&#34;bash&#34;</span>                   <span class="m">9</span> minutes ago       Exited <span class="o">(</span>0<span class="o">)</span> <span class="m">7</span> minutes ago                        zealous_tereshkova
e779e386475a        debian              <span class="s2">&#34;bash&#34;</span>                   <span class="m">21</span> minutes ago      Exited <span class="o">(</span>1<span class="o">)</span> <span class="m">20</span> minutes ago                       brave_meitner

root@FXSHELL /v/l/d/v/g/_data# docker container rm -f 4df1fe08b1da
4df1fe08b1da
root@FXSHELL /v/l/d/v/g/_data# docker container rm -f e779e386475a
e779e386475a

root@FXSHELL /v/l/d/v/g/_data# docker volume rm moranguinho
moranguinho
root@FXSHELL /v/l/d/v/g/_data# ls

</code></pre></div><p>E assim dentro da pasta /var/lib não temos mais nada do volume moranguinho.</p>
<p>Posso ver as propriedades do volume criado com o comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /v/l/d/v/g/_data# 
docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>bolacha,dst<span class="o">=</span>/bolacha debian


root@FXSHELL /v/l/d/v/g/_data <span class="o">[</span>1<span class="o">]</span><span class="c1"># docker container inspect 9d5997be4321</span>

        <span class="s2">&#34;Mounts&#34;</span>: <span class="o">[</span>
            <span class="o">{</span>
                <span class="s2">&#34;Type&#34;</span>: <span class="s2">&#34;volume&#34;</span>,
                <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;bolacha&#34;</span>,
                <span class="s2">&#34;Source&#34;</span>: <span class="s2">&#34;/var/lib/docker/volumes/bolacha/_data&#34;</span>,
                <span class="s2">&#34;Destination&#34;</span>: <span class="s2">&#34;/bolacha&#34;</span>,
                <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;local&#34;</span>,
                <span class="s2">&#34;Mode&#34;</span>: <span class="s2">&#34;z&#34;</span>,
                <span class="s2">&#34;RW&#34;</span>: true,
                <span class="s2">&#34;Propagation&#34;</span>: <span class="s2">&#34;&#34;</span>
            <span class="o">}</span>

</code></pre></div><p>Se dou um ls volume, o bolacha ainda estará lá.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL /v/l/d/v/g/_data# docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               bolacha
</code></pre></div><p>Posso utilizar o comando docker volume prune, para remover todos os volumes que estejam não estejam sendo utilizados.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker volume prune
WARNING! This will remove all <span class="nb">local</span> volumes not used by at least one container.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
Deleted Volumes:
bolacha

Total reclaimed space: 0B
</code></pre></div><p>Posso fazer a mesma coisa para os containers que não estou utilizando mais.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N<span class="o">]</span> y
Deleted Containers:
9911369c74af20bcbf144e1487c326d3d06dd23a0293d7b561e54049f5ddbc56
c72d32bd0846e51a0cbd495909440ee14b64b474611b356704ee3170bf1931b7
07b30662ffc0b0068862768cd6d7c92eafc372d71f5dffc17baca8079cfadf59
ebb965d5043752debf60498d0eac5620ffaecc079af3b557c145539d3d721508
493a598735c5cb1ec6f658df0a4ad5b157562cb462789d19521f1d1fcccbc5fc
acda8e5ec1adaaf1f2632be1fa8c2d6aedf9744be643991fea48d0d310fc3150
d7a861d6ea3811ed0273ac32ada6744a26ec85e14ff3b6c6ff5e3462004c3216
bcee760fd5702bb215b99da66109a3a59158aa5a47aae437d7ff4b516f93c38c
3d7c4a379d3e3d6a6710d581034d6199002942990f7d34ae5cb97617dd98ef32
2c6bcccf8f1727817a5da2c9b59edb7afdbb0790e3b3ba16a6298448d3cbb5a6
d21df8a6681620d956610f5e6808b21a0cd960d3c5a5c88da767b39efec4b674
ea431a856eff6fd17ff13d87ae498bfe91fb61fe6566744a528f62c1731689b5
8f88a55195f7defa35196f1d506a1d179af0099afbfcb34a9fd7fefef78240b6
40ab9db51e4a8c6e5603bdb51c60f37925e89d60afab8bda1ddf06071cb06ecc

Total reclaimed space: 870.3MB
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
root@FXSHELL ~# docker container ls -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
root@FXSHELL ~# 
</code></pre></div><p>Assim limpando tudo.</p>
<p>Agora um outro teste</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container create -v /opt/bolacha:/data --name dbdados centos
49eeb1ffb2453b206028478bc24f13582f5c1cb2ed2dbb378702ea10a7c5fb0c
</code></pre></div><p>Com isso, apenas criamos o container e especificamos um volume para ele, mas ainda não o iniciamos.</p>
<p>Sabemos que no container o volume se encontra montado em &ldquo;/data&rdquo;.</p>
<p>Agora vamos criar os containers que rodarão o Postgresql utilizando o volume &ldquo;/data&rdquo; do container &ldquo;dbdados&rdquo; para guardar os dados.</p>
<p>Para isso precisamos entender dois parâmetros importantes:</p>
<p>&ndash;volume-from : É utilizado quando queremos montar um volme disponibilizado por outro container.</p>
<p>-e : É utilizado para informar váriaveis de um ambiente para o container. No exemplo, estamos passando as variáveis de ambiente do PostgreSQL.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -d -p 5432:5432 --name pgsql1 --volumes-from dbdados -e <span class="nv">POSTGRESQL_USER</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_PASS</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_DB</span><span class="o">=</span>docker kamui/postgresql

</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -d -p 5433:5432 --name pgsql2 --volumes-from dbdados -e <span class="nv">POSTGRESQL_USER</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_PASS</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_DB</span><span class="o">=</span>docker kamui/postgresql
</code></pre></div><p>Criei duas.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container ls -a
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                    NAMES
79e408793331        kamui/postgresql    <span class="s2">&#34;/usr/local/bin/run&#34;</span>   <span class="m">8</span> seconds ago       Up <span class="m">7</span> seconds        0.0.0.0:5433-&gt;5432/tcp   pgsql2
2c2161d46619        kamui/postgresql    <span class="s2">&#34;/usr/local/bin/run&#34;</span>   <span class="m">6</span> minutes ago       Up <span class="m">6</span> minutes        0.0.0.0:5432-&gt;5432/tcp   pgsql1
49eeb1ffb245        centos              <span class="s2">&#34;/bin/bash&#34;</span>            <span class="m">10</span> minutes ago      Created                                      dbdados
root@FXSHELL ~# 
</code></pre></div><p>Fazendo da forma nova e atualizada:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker volume create dbdados
dbdados

root@FXSHELL ~# docker container run -d -p 5432:5432 --name pgsql1  --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>dbdados,dst<span class="o">=</span>/data -e <span class="nv">POSTGRESQL_USER</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_PASS</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_DB</span><span class="o">=</span>docker kamui/postgresql
1fbdf3f70d206cebb44049c737e2d08359118df654bcf9481a5a46c99ab47ccc
root@FXSHELL ~# docker container run -d -p 5433:5432 --name pgsql2  --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>dbdados,dst<span class="o">=</span>/data -e <span class="nv">POSTGRESQL_USER</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_PASS</span><span class="o">=</span>docker -e <span class="nv">POSTGRESQL_DB</span><span class="o">=</span>docker kamui/postgresql
368bc32d8ca3203dd8962ced0a6a4b999f56751462f121d3100c00169e43e4a8
root@FXSHELL ~# docker container ls
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                    NAMES
368bc32d8ca3        kamui/postgresql    <span class="s2">&#34;/usr/local/bin/run&#34;</span>   <span class="m">5</span> seconds ago       Up <span class="m">3</span> seconds        0.0.0.0:5433-&gt;5432/tcp   pgsql2
1fbdf3f70d20        kamui/postgresql    <span class="s2">&#34;/usr/local/bin/run&#34;</span>   <span class="m">16</span> seconds ago      Up <span class="m">14</span> seconds       0.0.0.0:5432-&gt;5432/tcp   pgsql1
root@FXSHELL ~# docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               dbdados
root@FXSHELL ~# 
</code></pre></div><p>E assim os dados do postgreSQL estão la dentro:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# <span class="nb">cd</span> /var/lib/docker/volumes/dbdados/_data
root@FXSHELL /v/l/d/v/d/_data# ls
base/          pg_multixact/  pg_stat_tmp/  pg_xlog/         server.key@
global/        pg_notify/     pg_subtrans/  postgresql.conf
pg_clog/       pg_serial/     pg_tblspc/    postmaster.opts
pg_hba.conf    pg_snapshots/  pg_twophase/  postmaster.pid
pg_ident.conf  pg_stat/       PG_VERSION    server.crt@
root@FXSHELL /v/l/d/v/d/_data# 
</code></pre></div><p>Supondo que quero fazer um backup deste cara, e encarrego outro container de fazer isso, posso fazer algo assim:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# mkdir /opt/backup
root@FXSHELL ~# 
root@FXSHELL ~# 
root@FXSHELL ~# 
root@FXSHELL ~# 
root@FXSHELL ~# docker container run -ti --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>dbdados,dst<span class="o">=</span>/data --mount <span class="nv">type</span><span class="o">=</span>bind,src<span class="o">=</span>/opt/backup,dst<span class="o">=</span>/backup debian tar -cvf /backup/bkp-banco.tar /data
</code></pre></div><p>montando um volume do tipo bind dentro deste novo container e empacotando com o tar, o bkp.</p>
<p>#EXEMPLO DE COMANDOS</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># docker container run -ti --mount type=bind,src=/volume,dst=/volume ubuntu</span>
<span class="c1"># docker container run -ti --mount type=bind,src=/root/primeiro_container,dst=/volume ubuntu</span>
<span class="c1"># docker container run -ti --mount type=bind,src=/root/primeiro_container,dst=/volume,ro ubuntu</span>
<span class="c1"># docker volume create moranguinho</span>
<span class="c1"># docker volume rm moranguinho</span>
<span class="c1"># docker volume inspect moranguinho</span>
<span class="c1"># docker volume prune</span>
<span class="c1"># docker container run -d --mount type=volume,source=moranguinho,destination=/var/opa  nginx</span>
<span class="c1"># docker container create -v /data --name dbdados centos</span>
<span class="c1"># docker run -d -p 5432:5432 --name pgsql1 --volumes-from dbdados -e POSTGRESQL_USER=docker -e POSTGRESQL_PASS=docker -e POSTGRESQL_DB=docker kamui/postgresql</span>
<span class="c1"># docker run -d -p 5433:5432 --name pgsql2 --volumes-from dbdados -e  POSTGRESQL_USER=docker -e POSTGRESQL_PASS=docker -e POSTGRESQL_DB=docker kamui/postgresql</span>
<span class="c1"># docker run -ti --volumes-from dbdados -v $(pwd):/backup debian tar -cvf /backup/backup.tar /data</span>
</code></pre></div><p>#Criando um dockerfile</p>
<p>$ vim dockerfiles/1/Dockerfile</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM debian <span class="c1">#qual imagem vou me basear</span>

RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apache2 <span class="o">&amp;&amp;</span> apt-get clean  <span class="c1">#executa oque vai fazer</span>
ENV <span class="nv">APACHE_LOCK_DIR</span><span class="o">=</span><span class="s2">&#34;/var/lock&#34;</span>   <span class="c1">#Variavel de ambiente para não ter dois apache rodando</span>
ENV <span class="nv">APACHE_PID_FILE</span><span class="o">=</span><span class="s2">&#34;/var/run/apache2.pid&#34;</span>  <span class="c1">#Variavel de ambiente de identificação do processo</span>
ENV <span class="nv">APACHE_RUN_USER</span><span class="o">=</span><span class="s2">&#34;www.data&#34;</span>         <span class="c1">#Variavel de ambiente usuário responsável pelo apache</span>
ENV <span class="nv">APACHE_RUN_GROUP</span><span class="o">=</span><span class="s2">&#34;www-data&#34;</span>         <span class="c1">#Variavel de ambiente grupo responsável pelo apache</span>
ENV <span class="nv">APACHE_LOG_DIR</span><span class="o">=</span><span class="s2">&#34;/var/log/apache2&#34;</span> <span class="c1">#onde vai salvar os logs do apache</span>

LABEL <span class="nv">description</span><span class="o">=</span><span class="s2">&#34;Webserver&#34;</span> <span class="c1">#faz uma descrição (qualquer chave=valor)</span>
LABEL <span class="nv">version</span><span class="o">=</span><span class="s2">&#34;1.0.0&#34;</span>

VOLUME /var/www/html <span class="c1">#docker vai criar automaticamente esse volume</span>
EXPOSE <span class="m">80</span> <span class="c1">#com a flag -P irá pegar o expose qualquer porta = 80</span>
</code></pre></div><p>Para criar o container eu faço um docker build.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker build .

ou

root@FXSHELL ~# docker image build -t meu_apache:1.0 .
</code></pre></div><p>#Exemplos de Dockerfiles</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM debian

RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apache2 <span class="o">&amp;&amp;</span> apt-get clean
ENV <span class="nv">APACHE_LOCK_DIR</span><span class="o">=</span><span class="s2">&#34;/var/lock&#34;</span>
ENV <span class="nv">APACHE_PID_FILE</span><span class="o">=</span><span class="s2">&#34;/var/run/apache2.pid&#34;</span>
ENV <span class="nv">APACHE_RUN_USER</span><span class="o">=</span><span class="s2">&#34;www-data&#34;</span>
ENV <span class="nv">APACHE_RUN_GROUP</span><span class="o">=</span><span class="s2">&#34;www-data&#34;</span>
ENV <span class="nv">APACHE_LOG_DIR</span><span class="o">=</span><span class="s2">&#34;/var/log/apache2&#34;</span>

LABEL <span class="nv">description</span><span class="o">=</span><span class="s2">&#34;Webserver&#34;</span>

VOLUME /var/www/html/
EXPOSE <span class="m">80</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM debian

RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apache2 <span class="o">&amp;&amp;</span> apt-get clean
ENV <span class="nv">APACHE_LOCK_DIR</span><span class="o">=</span><span class="s2">&#34;/var/lock&#34;</span>
ENV <span class="nv">APACHE_PID_FILE</span><span class="o">=</span><span class="s2">&#34;/var/run/apache2/apache2.pid&#34;</span>
ENV <span class="nv">APACHE_RUN_USER</span><span class="o">=</span><span class="s2">&#34;www-data&#34;</span>
ENV <span class="nv">APACHE_RUN_DIR</span><span class="o">=</span><span class="s2">&#34;/var/run/apache2&#34;</span>
ENV <span class="nv">APACHE_RUN_GROUP</span><span class="o">=</span><span class="s2">&#34;www-data&#34;</span>
ENV <span class="nv">APACHE_LOG_DIR</span><span class="o">=</span><span class="s2">&#34;/var/log/apache2&#34;</span>

LABEL <span class="nv">description</span><span class="o">=</span><span class="s2">&#34;Webserver&#34;</span>

VOLUME /var/www/html/
EXPOSE <span class="m">80</span>

ENTRYPOINT <span class="o">[</span><span class="s2">&#34;/usr/sbin/apachectl&#34;</span><span class="o">]</span>
CMD <span class="o">[</span><span class="s2">&#34;-D&#34;</span>, <span class="s2">&#34;FOREGROUND&#34;</span><span class="o">]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">package main
import <span class="s2">&#34;fmt&#34;</span>

func main<span class="o">()</span> <span class="o">{</span>
    fmt.Println<span class="o">(</span><span class="s2">&#34;GIROPOPS STRIGUS GIRUS - LINUXTIPS&#34;</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM golang

WORKDIR /app
ADD . /app
RUN go build -o goapp
ENTRYPOINT ./goapp
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">FROM golang AS buildando

ADD . /src
WORKDIR /src
RUN go build -o goapp


FROM alpine:3.1

WORKDIR /app
COPY --from<span class="o">=</span>buildando /src/goapp /app
ENTRYPOINT ./goapp
</code></pre></div><p>ADD =&gt; Copia novos arquivos, diretórios, arquivos TAR ou arquivos remotos e os adicionam ao filesystem do container;</p>
<p>CMD =&gt; Executa um comando, diferente do RUN que executa o comando no momento em que está &ldquo;buildando&rdquo; a imagem, o CMD executa no início da execução do container;</p>
<p>LABEL =&gt; Adiciona metadados a imagem como versão, descrição e fabricante;</p>
<p>COPY =&gt; Copia novos arquivos e diretórios e os adicionam ao filesystem do container;</p>
<p>ENTRYPOINT =&gt; Permite você configurar um container para rodar um executável, e quando esse executável for finalizado, o container também será;</p>
<p>ENV =&gt; Informa variáveis de ambiente ao container;</p>
<p>EXPOSE =&gt; Informa qual porta o container estará ouvindo;</p>
<p>FROM =&gt; Indica qual imagem será utilizada como base, ela precisa ser a primeira linha do Dockerfile;</p>
<p>MAINTAINER =&gt; Autor da imagem;</p>
<p>RUN =&gt; Executa qualquer comando em uma nova camada no topo da imagem e &ldquo;commita&rdquo; as alterações. Essas alterações você poderá utilizar nas próximas instruções de seu Dockerfile;</p>
<p>USER =&gt; Determina qual o usuário será utilizado na imagem. Por default é o root;</p>
<p>VOLUME =&gt; Permite a criação de um ponto de montagem no container;</p>
<p>WORKDIR =&gt; Responsável por mudar do diretório / (raiz) para o especificado nele;</p>
<ul>
<li>
<p>Um Dockerfile serve para criar uma imagem de um container</p>
<p>A finalidade da instrução FROM no Dockerfile é para indicar uma imagem base</p>
<p>Para &ldquo;buildar&rdquo; uma nova imagem, utilizo o comando, &lsquo;docker build -t nomedaimagem:1.0 .&rsquo;</p>
<p>As instruções para que o Dockerfile adicione um arquivo, são &lsquo;ADD&rsquo; ou &lsquo;COPY&rsquo;</p>
<p>No momento de criação da imagem o Dockerfile executa o comando &lsquo;RUN&rsquo;</p>
<p>Os comandos que executam um comando na inicialização do container são &lsquo;ENTRYPOINT&rsquo; ou &lsquo;CMD&rsquo;</p>
<p>A instrução que indica qual usuário que será utilizado no container é o &lsquo;USER&rsquo;</p>
<p>Indica que determinado diretório no container será um volume com o comando &lsquo;VOLUME&rsquo;</p>
<p>É possível ter duas instruções FROM dentro do mesmo Dockerfile.</p>
<p>Para referenciá-lo em outra parte do arquivo utilizo o &lsquo;FROM debian AS giropops&rsquo;</p>
<p>Para listar todas as imagens do container eu faço &lsquo;docker image ls&rsquo;</p>
<p>É possível criar uma imagem a partir de um container em execução.</p>
<p>Com o comando &ldquo;docker commit&rdquo; eu crio uma imagem apartir de um container em execução.</p>
</li>
</ul>
<p>**</p>
<p>#SUBINDO UMA IMAGEM PARA SUA CONTA DO DOCKERHUB</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~/d/2# docker image ls
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
fpmatta/toddy   1.0       e1c0c1113bca   <span class="m">6</span> minutes ago   267MB
ubuntu          latest    f63181f19b2f   <span class="m">12</span> days ago     72.9MB

root@FXSHELL ~/d/2# docker login
Authenticating with existing credentials...
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded

root@FXSHELL ~/d/2# docker push fpmatta/toddy:1.0
The push refers to repository <span class="o">[</span>docker.io/fpmatta/toddy<span class="o">]</span>
b43d9cffa997: Pushing <span class="o">[==============================================</span>&gt;    <span class="o">]</span>  178.2MB/193.7MB
02473afd360b: Mounted from library/ubuntu 
dbf2c0f42a39: Preparing 
9f32931c9d28: Preparing 
</code></pre></div><p>#Não confio na internet; posso criar o meu registry local</p>
<p>Subindo o registry local:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container run -d -p 5000:5000 --restart<span class="o">=</span>always --name registry registry:2
</code></pre></div><p>Consigo ver o container do registry rodando bem como sua imagem.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container ls
CONTAINER ID   IMAGE        COMMAND                  CREATED          STATUS          PORTS                    NAMES
49fbebd0365b   registry:2   <span class="s2">&#34;/entrypoint.sh /etc…&#34;</span>   <span class="m">34</span> seconds ago   Up <span class="m">32</span> seconds   0.0.0.0:5000-&gt;5000/tcp   registry
root@FXSHELL ~# docker image ls
REPOSITORY      TAG       IMAGE ID       CREATED          SIZE
fpmatta/toddy   1.0       e1c0c1113bca   <span class="m">31</span> minutes ago   267MB
registry        <span class="m">2</span>         678dfa38fcfa   <span class="m">6</span> weeks ago      26.2MB
root@FXSHELL ~# 
</code></pre></div><p>Preciso retagear o nome da minha imagem, passando o meu registry local que no caso é o &lsquo;localhost:5000&rsquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker image ls
REPOSITORY      TAG       IMAGE ID       CREATED          SIZE
fpmatta/toddy   1.0       e1c0c1113bca   <span class="m">31</span> minutes ago   267MB
registry        <span class="m">2</span>         678dfa38fcfa   <span class="m">6</span> weeks ago      26.2MB
root@FXSHELL ~# docker tag e1c0c1113bca localhost:5000/fpmatta/toddy:1.0
root@FXSHELL ~# docker image ls
REPOSITORY                     TAG       IMAGE ID       CREATED          SIZE
fpmatta/toddy                  1.0       e1c0c1113bca   <span class="m">35</span> minutes ago   267MB
localhost:5000/fpmatta/toddy   1.0       e1c0c1113bca   <span class="m">35</span> minutes ago   267MB
registry                       <span class="m">2</span>         678dfa38fcfa   <span class="m">6</span> weeks ago      26.2MB
root@FXSHELL ~# docker image push localhost:5000/fpmatta/toddy:1.0
The push refers to repository <span class="o">[</span>localhost:5000/fpmatta/toddy<span class="o">]</span>
b43d9cffa997: Pushing <span class="o">[==================================================</span>&gt;<span class="o">]</span>  199.9MB
02473afd360b: Pushed 
dbf2c0f42a39: Pushed 
9f32931c9d28: Pushed 
</code></pre></div><p>Para checar sua imagem dentro do registry fica no caminho abaixo:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">/var/lib/registry/docker/registry/v2/repositories/fpmatta/toddy 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL ~# docker container ls
CONTAINER ID   IMAGE                              COMMAND                  CREATED          STATUS          PORTS                    NAMES
a3c92b51fe5b   localhost:5000/fpmatta/toddy:1.0   <span class="s2">&#34;/bin/bash&#34;</span>              <span class="m">13</span> minutes ago   Up <span class="m">13</span> minutes                            exciting_heyrovsky
49fbebd0365b   registry:2                         <span class="s2">&#34;/entrypoint.sh /etc…&#34;</span>   <span class="m">30</span> minutes ago   Up <span class="m">30</span> minutes   0.0.0.0:5000-&gt;5000/tcp   registry
root@FXSHELL ~# docker <span class="nb">exec</span> -ti 49fbebd0365b sh
/ <span class="c1"># ls</span>
bin            entrypoint.sh  home           media          opt            root           sbin           sys            usr
dev            etc            lib            mnt            proc           run            srv            tmp            var
/ <span class="c1"># cd /var/</span>
cache/  empty/  lib/    local/  lock/   log/    mail/   opt/    run/    spool/  tmp/
/ <span class="c1"># cd /var/lib/</span>
apk/       misc/      registry/  udhcpd/
/ <span class="c1"># cd /var/lib/registry/docker/registry/v2/</span>
/var/lib/registry/docker/registry/v2 <span class="c1"># ls</span>
blobs         repositories
/var/lib/registry/docker/registry/v2 <span class="c1"># cd repositories/</span>
/var/lib/registry/docker/registry/v2/repositories <span class="c1"># ls</span>
fpmatta
/var/lib/registry/docker/registry/v2/repositories <span class="c1"># cd fpmatta/</span>
/var/lib/registry/docker/registry/v2/repositories/fpmatta <span class="c1"># ls</span>
toddy
/var/lib/registry/docker/registry/v2/repositories/fpmatta <span class="c1"># cd toddy/</span>
/var/lib/registry/docker/registry/v2/repositories/fpmatta/toddy <span class="c1"># ls</span>
_layers     _manifests  _uploads
/var/lib/registry/docker/registry/v2/repositories/fpmatta/toddy <span class="c1"># </span>
</code></pre></div><p>#DockerHub e Registry - Exemplo comandos
docker image inspect debian</p>
<p>docker history linuxtips/apache:1.0</p>
<p>docker login</p>
<p>docker login registry.suaempresa.com</p>
<p>docker push linuxtips/apache:1.0</p>
<p>docker pull linuxtips/apache:1.0</p>
<p>docker image ls</p>
<p>docker container run -d -p 5000:5000 &ndash;restart=always &ndash;name registry registry:2</p>
<p>docker tag IMAGEMID localhost:5000/apache</p>
<h1 id="docker-machine">Docker Machine</h1>
<p>Para fazer a instalação do Docker Machine no Linux, faça:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># curl -L https://github.com/docker/machine/releases/download/v0.16.1</span>
/docker-machine-<span class="sb">`</span>uname -s<span class="sb">`</span>-<span class="sb">`</span>uname -m<span class="sb">`</span> &gt;/tmp/docker-machine
<span class="c1"># chmod +x /tmp/docker-machine </span>
<span class="c1"># sudo cp /tmp/docker-machine /usr/local/bin/docker-machine</span>


Para seguir com a instalação no macOS:

<span class="c1"># curl -L https://github.com/docker/machine/releases/download/v0.16.1</span>
/docker-machine-<span class="sb">`</span>uname -s<span class="sb">`</span>-<span class="sb">`</span>uname -m<span class="sb">`</span> &gt;/usr/local/bin/docker-machine 
<span class="c1"># chmod +x /usr/local/bin/docker-machine</span>

Para seguir com a instalação no Windows caso esteja usando o Git bash:

<span class="c1"># if [[ ! -d &#34;$HOME/bin&#34; ]]; then mkdir -p &#34;$HOME/bin&#34;; fi</span>
<span class="c1"># curl -L https://github.com/docker/machine/releases/download/v0.16.1</span>
/docker-machine-Windows-x86_64.exe &gt; <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/bin/docker-machine.exe&#34;</span>
<span class="c1"># chmod +x &#34;$HOME/bin/docker-machine.exe&#34;</span>


Para verificar se ele foi instalado e qual a sua versão, faça:

<span class="c1"># docker-machine version</span>

<span class="c1"># docker-machine create --driver virtualbox linuxtips</span>

<span class="c1"># docker-machine ls</span>

<span class="c1"># docker-machine env linuxtips</span>

<span class="c1"># eval &#34;$(docker-machine env linuxtips)&#34;</span>

<span class="c1"># docker container ls</span>

<span class="c1"># docker container run busybox echo &#34;LINUXTIPS, VAIIII&#34;</span>

<span class="c1"># docker-machine ip linuxtips</span>

<span class="c1"># docker-machine ssh linuxtips</span>

<span class="c1"># docker-machine inspect linuxtips</span>

<span class="c1"># docker-machine stop linuxtips</span>

<span class="c1"># docker-machine ls </span>

<span class="c1"># docker-machine start linuxtips</span>

<span class="c1"># docker-machine rm linuxtips</span>

<span class="c1"># eval $(docker-machine env -u)</span>
</code></pre></div><h1 id="docker-swarm">Docker Swarm</h1>
<p>Você consegue construir clusters de containers com caracateristicas importantes como balanceador de cargas e failover.</p>
<p>Para criar um clustercom o docker  swarm, basta indicar quais os hosts que ele irá supervisionar e o restante é com ele.</p>
<p>Cuida automaticamente do balanceamento de carga.</p>
<p>O Docker Swarm é bastante simples e se resume a um manager e diversos workers. O manager é o responsavel por orquestrar os containers e distribui-los entre os hosts workers. Os workers são os que carregam o piano, e hospedam os containers.</p>
<p>Worker = Container em execução</p>
<p>Manager = Conhece os detalhes do cluster, sabe todos os containers e serviços.</p>
<p>Para testar, podemos subir três maquinas e instalar o docker em cada uma delas.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL-01 ~# 
root@FXSHELL-02 ~# 
root@FXSHELL-03 ~# 
</code></pre></div><p>Feito isso, basta rodar na maquina 01, o comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker swarm init
</code></pre></div><p>Será gerado um token, que iremos utilizar e rodar nas maquinas do node, que serão as maquinas 02 e 03.</p>
<p>Depois podera visualizar na maquina manager, todos os nodes que estão adicionados com o comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node ls
</code></pre></div><p>Para visualizar o token da maquina 02 para adiciona-la commo manager e não como worker, basta fazer:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker swarm join-token manager
</code></pre></div><p>Com isso será exibido o token de manager, para ser executado no seu outro host.</p>
<p>Mesma coisa caso fosse um worker</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker swarm join-token worker
</code></pre></div><p>Para promover um node worker para manager basta fazer:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node promote maquina-02
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node demote maquina-02
</code></pre></div><p>Agora se você quiser remover o node do cluster basta digitar o comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker swarm leave
</code></pre></div><p>Também remova ele do nosso manager ativo, com o comando</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node rm maquina-02
</code></pre></div><p>Para remover um node manager, é necessário forçar com a flag &ndash;force</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker swarm leave --force
</code></pre></div><p>E depois remover do node manager</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node rm maquina-03
</code></pre></div><h1 id="docker-services">Docker Services</h1>
<p>O service é um VIP ou DNS que realizara o balanceamento de requisições entre os containers. Podemos estabelecer um numero x de containers respondendo por um service e esses containers estarão espalhados pelo nosso cluster, entre nossos nodes, garantindo alta disponibilidade e balanceamento de carga. Tudo isso nativamente.</p>
<p>Os services é uma forma, já utlizada no kubernetes, de você conseguir gerenciar melhor seus containers. Também uma maneira muito simples e efetiva para escalar seu ambiente. Aumentando ou diminuindo a quantidade de containers que responderá para determinado service.</p>
<p>Exemplo:</p>
<p>Nome do service que desejo criar: webserver</p>
<p>Quantidade de containers que desejo debaixo do service: 5</p>
<p>Portas que iremos blindar, entre o service e o node: 8080:80</p>
<p>Imagem dos containers que irei utilizar: NGINX</p>
<p>O comando ficaria assim =&gt;</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service create --name webserver --replicas <span class="m">5</span> -p 8080:80 nginx
</code></pre></div><p>Para testar faça um curl em qualquer ip dos nodes que subiu:8080</p>
<p>Para listar os services faça</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service ls
</code></pre></div><p>Se quisermos saber onde estão rodando nossos containers, em quais nodes eles estçao sendo executados, basta digitar o seguinte comando:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service ps webserver
</code></pre></div><p>Assim conseguiremos saber onde está rodando cada container e ainda o seu status.</p>
<p>Se precisamos saber maiores detalhes sobre o service, basta utlizar o subcomando &ldquo;inspect&rdquo;.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service inspect webserver
</code></pre></div><p>Na saída do &ldquo;inspect&rdquo; conseguiremos pegar informações importantes sobre nosso service, como portas expostas, volumes, containers, limitações, entre outras coisas.</p>
<p>Lembre-se meu cenário de nodes é:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@FXSHELL-01 ~# 
root@FXSHELL-02 ~# 
root@FXSHELL-03 ~# 
</code></pre></div><p>Posso ter muitas replicas divididas e distribuidas e balanceadas nesses 3 nodes.</p>
<p>Uma informação muito importante é o endereço do VIP do service, que estara listado no comando &ldquo;insepect&rdquo;.</p>
<p>Esse é o endereço do IP do balanceador desse service, ou seja, sempre que acessarem via esse IP, ele distribuirá a conexão entre os containers.</p>
<p>Agora se quisermos aumentar o número de containers debaixo desse service, é muito simples. Basta executar o comando a seguir:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service scale <span class="nv">webserver</span><span class="o">=</span><span class="m">5</span>
</code></pre></div><p>Pronto, agora temos dez containers respondendo requisições debaido do nosso service webserver.</p>
<p>Para visualizar basta executar:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service ls
</code></pre></div><p>Ah não quero que um determinado node receba mais containers, posso dar um pause neste cara, com o comando abaixo:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node update --availability pause FXSHELL-02
</code></pre></div><p>Para ativa-lo novamente:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node update --availability active FXSHELL-02
</code></pre></div><p>Para retirar temporariamente um node para manutenção por exemplo, faça:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker node update --availability drain FXSHELL-02
</code></pre></div><p>Todos os containers que estavam no FXSHELL-02, vão ser realocados para os outros 2.</p>
<p>Para visualizar basta executar:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service ps webserver
</code></pre></div><p>Para saber em quais nodes eseles estão em execução, lembre-se do &lsquo;docker service ls webserver&rsquo;</p>
<p>Para acessar os logs desse service, basta digitar:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service logs -f webserver
</code></pre></div><p>Assim você terá acesso aos logs de todos os containers desse service.</p>
<p>Para remover o service é simples</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service rm webserver
</code></pre></div><p>Você pode checar com o comando</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service ls
</code></pre></div><p>Criar um service com um volume conectado é bastante simples, basta fazer:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">docker service create --name webserver --replicas <span class="m">5</span> -p 8080:80 --mount <span class="nv">type</span><span class="o">=</span>volume,src<span class="o">=</span>teste,dst<span class="o">=</span>/app, nginx
</code></pre></div><p>Quando criamos um service com um volume conectado a ele, isso indica que esse volume estará disponivel em todos os nossos containers desse service, ou seja, o volume com o nome de &ldquo;teste&rdquo; estara montado em todos os containers no diretorio &ldquo;/app&rdquo;.</p>
<p>Exemplo de como ficou:</p>
<p><img src="/volumes_exemplo_services.png" alt="HTB"></p>
<h1 id="docker-secrets">Docker Secrets!!!!!!!##</h1>

</main>
    <footer>
  

</footer>
  </body>
</html>
